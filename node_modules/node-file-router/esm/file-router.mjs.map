{"version":3,"file":"file-router.mjs","names":["path","process","FileRouteResolver","isFunction","isRecordWith","resolveNotFoundHandler","httpAdapter","validateBaseDirExistence","initFileRouter","baseDir","ignoreFilesRegex","clearImportCache","adapter","getPathname","defaultNotFoundHandler","getMethod","normalizedBaseDir","isAbsolute","join","cwd","fileRouteResolver","routeHandlers","getHandlers","notFoundHandler","requestHandler","args","pathname","method","matchedRoute","find","regex","routeMethod","test","handler","routeParams","getRouteParams"],"sources":["../../src/file-router.ts"],"sourcesContent":["import * as path from 'node:path';\nimport * as process from 'node:process';\n\nimport { FileRouteResolver } from './components/file-route-resolver';\nimport { isFunction, isRecordWith } from './utils/object.utils';\nimport { resolveNotFoundHandler } from './components/not-found-resolver';\nimport { httpAdapter } from './adapters/http-adapter';\nimport { validateBaseDirExistence } from './validations/validations';\n\nimport type { Adapter } from './types/adapter';\nimport type { RequestHandler } from './types/request-handler';\n\ninterface Options {\n  baseDir?: string;\n  ignoreFilesRegex?: RegExp[];\n  adapter?: Adapter;\n  clearImportCache?: boolean;\n}\n\nexport async function initFileRouter({\n  baseDir = 'api',\n  ignoreFilesRegex,\n  clearImportCache = false,\n  adapter = httpAdapter\n}: Options = {}) {\n  const { getPathname, defaultNotFoundHandler, getMethod } = adapter;\n\n  const normalizedBaseDir = path.isAbsolute(baseDir)\n    ? baseDir\n    : path.join(process.cwd(), baseDir);\n\n  await validateBaseDirExistence(normalizedBaseDir);\n\n  const fileRouteResolver = new FileRouteResolver({\n    baseDir: normalizedBaseDir,\n    ignoreFilesRegex,\n    clearImportCache\n  });\n\n  const routeHandlers = await fileRouteResolver.getHandlers();\n\n  const notFoundHandler =\n    (await resolveNotFoundHandler(normalizedBaseDir)) || defaultNotFoundHandler;\n\n  return function requestHandler(...args: unknown[]) {\n    const pathname = getPathname(...args);\n\n    const method = getMethod && getMethod(...args);\n    const matchedRoute = routeHandlers.find(\n      ({ regex, method: routeMethod }) =>\n        regex.test(pathname) && (!routeMethod || method === routeMethod)\n    );\n    if (!matchedRoute) {\n      return notFoundHandler(...args);\n    }\n\n    const { handler } = matchedRoute;\n    const routeParams = matchedRoute.getRouteParams(pathname);\n    if (isRecordWith<RequestHandler>(handler) && method && handler[method]) {\n      return handler[method](...args, routeParams);\n    }\n\n    if (isFunction(handler)) {\n      return handler(...args, routeParams);\n    }\n\n    return notFoundHandler(...args, routeParams);\n  };\n}\n"],"mappings":"AAAA,OAAO,KAAKA,IAAI,MAAM,WAAW;AACjC,OAAO,KAAKC,OAAO,MAAM,cAAc;AAAC,SAE/BC,iBAAiB;AAAA,SACjBC,UAAU,EAAEC,YAAY;AAAA,SACxBC,sBAAsB;AAAA,SACtBC,WAAW;AAAA,SACXC,wBAAwB;AAYjC,OAAO,eAAeC,cAAcA,CAAC;EACnCC,OAAO,GAAG,KAAK;EACfC,gBAAgB;EAChBC,gBAAgB,GAAG,KAAK;EACxBC,OAAO,GAAGN;AACH,CAAC,GAAG,CAAC,CAAC,EAAE;EACf,MAAM;IAAEO,WAAW;IAAEC,sBAAsB;IAAEC;EAAU,CAAC,GAAGH,OAAO;EAElE,MAAMI,iBAAiB,GAAGhB,IAAI,CAACiB,UAAU,CAACR,OAAO,CAAC,GAC9CA,OAAO,GACPT,IAAI,CAACkB,IAAI,CAACjB,OAAO,CAACkB,GAAG,CAAC,CAAC,EAAEV,OAAO,CAAC;EAErC,MAAMF,wBAAwB,CAACS,iBAAiB,CAAC;EAEjD,MAAMI,iBAAiB,GAAG,IAAIlB,iBAAiB,CAAC;IAC9CO,OAAO,EAAEO,iBAAiB;IAC1BN,gBAAgB;IAChBC;EACF,CAAC,CAAC;EAEF,MAAMU,aAAa,GAAG,MAAMD,iBAAiB,CAACE,WAAW,CAAC,CAAC;EAE3D,MAAMC,eAAe,GACnB,CAAC,MAAMlB,sBAAsB,CAACW,iBAAiB,CAAC,KAAKF,sBAAsB;EAE7E,OAAO,SAASU,cAAcA,CAAC,GAAGC,IAAe,EAAE;IACjD,MAAMC,QAAQ,GAAGb,WAAW,CAAC,GAAGY,IAAI,CAAC;IAErC,MAAME,MAAM,GAAGZ,SAAS,IAAIA,SAAS,CAAC,GAAGU,IAAI,CAAC;IAC9C,MAAMG,YAAY,GAAGP,aAAa,CAACQ,IAAI,CACrC,CAAC;MAAEC,KAAK;MAAEH,MAAM,EAAEI;IAAY,CAAC,KAC7BD,KAAK,CAACE,IAAI,CAACN,QAAQ,CAAC,KAAK,CAACK,WAAW,IAAIJ,MAAM,KAAKI,WAAW,CACnE,CAAC;IACD,IAAI,CAACH,YAAY,EAAE;MACjB,OAAOL,eAAe,CAAC,GAAGE,IAAI,CAAC;IACjC;IAEA,MAAM;MAAEQ;IAAQ,CAAC,GAAGL,YAAY;IAChC,MAAMM,WAAW,GAAGN,YAAY,CAACO,cAAc,CAACT,QAAQ,CAAC;IACzD,IAAItB,YAAY,CAAiB6B,OAAO,CAAC,IAAIN,MAAM,IAAIM,OAAO,CAACN,MAAM,CAAC,EAAE;MACtE,OAAOM,OAAO,CAACN,MAAM,CAAC,CAAC,GAAGF,IAAI,EAAES,WAAW,CAAC;IAC9C;IAEA,IAAI/B,UAAU,CAAC8B,OAAO,CAAC,EAAE;MACvB,OAAOA,OAAO,CAAC,GAAGR,IAAI,EAAES,WAAW,CAAC;IACtC;IAEA,OAAOX,eAAe,CAAC,GAAGE,IAAI,EAAES,WAAW,CAAC;EAC9C,CAAC;AACH"}